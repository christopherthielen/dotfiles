{{- if .isWork -}}
##### BEGIN METATRON AUTOCONFIG
# Do not remove the above line. The metatron CLI uses it to update this file.
# Set git proxy configuration (must be the first directive in this file)
[include]
    path = {{ .chezmoi.homeDir }}/.gitconfig-proxy
# Do not remove the below line. The metatron CLI uses it to update this file.
##### END METATRON AUTOCONFIG

{{ end }}
[user]
    name = {{ .name }}
    email = {{ .email }}

[init]
    defaultBranch = main

[core]
    excludesfile = ~/.gitignore_global
    pager = "diff-so-fancy | less --tabs=4 -RFX"
{{- if eq .chezmoi.os "darwin" }}
    fsmonitor = true
{{- end }}
    untrackedCache = true

{{- if eq .chezmoi.os "darwin" }}

[credential]
    helper = osxkeychain
{{- end }}

[pull]
    ff = only
    rebase = true

[push]
    default = simple
    autoSetupRemote = true

[fetch]
    all = true

[rebase]
    autoStash = true
    autoSquash = true
    updateRefs = true

[rerere]
    enabled = true
    autoupdate = true

[merge]
    conflictstyle = zdiff3

[diff]
    algorithm = histogram
    colorMoved = plain
    mnemonicPrefix = true
    renames = true
    wordRegex = .

[diff-so-fancy]
    markEmptyLines = false
    first-run = false

[color]
    ui = true

[column]
    ui = auto

[branch]
    sort = -committerdate

[tag]
    sort = version:refname

[help]
    autocorrect = prompt

[commit]
    verbose = true

[filter "lfs"]
    clean = git-lfs clean -- %f
    smudge = git-lfs smudge -- %f
    process = git-lfs filter-process
    required = true

[alias]
    aliases = config --get-regexp alias

    please = push --force-with-lease
    up = pull --rebase
    co = checkout
    ci = commit
    br = branch
    sw = switch
    st = status

    # log commands
    json = log --format='{ \"hashes\":{ \"commit\":\"%H\", \"tree\":\"%T\", \"parents\":\"%P\" }, \"author\":{ \"date\": \"%ai\", \"name\": \"%an\", \"email\":\"%ae\" }, \"committer\":{ \"date\": \"%ci\", \"name\": \"%cn\", \"email\":\"%ce\" } }'
    le = log --oneline --decorate
    ll = log --pretty=format:\"%C(yellow)%h%Cred%d\\ %Creset%s%Cblue\\ [%cn]\" --decorate --stat
    ls = log --pretty=format:\"%C(yellow)%h%Cred%d\\ %Creset%s%Cblue\\ [%cn]\" --decorate
    lds = log --pretty=format:\"%C(yellow)%h\\ %ad%Cred%d\\ %Creset%s%Cblue\\ [%cn]\" --decorate --date=short
    ld = log --pretty=format:\"%C(yellow)%h\\ %ad%Cred%d\\ %Creset%s%Cblue\\ [%cn]\" --decorate --date=relative
    lc  = "!f() { git ll \"$1\"^..\"$1\"; }; f"
    lnc = log --pretty=format:\"%h\\ %s\\ [%cn]\"
    lg = log --graph --oneline --decorate --all
    grog = log --graph --abbrev-commit --decorate --all --format=format:\"%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(dim white) - %an%C(reset) %C(bold green)(%ar)%C(reset)%C(bold yellow)%d%C(reset)%n %C(white)%s%C(reset)\"

    # list all aliases
    la = "!git config -l | grep alias | cut -c 7-"
    d = diff --word-diff
    dc = diff --cached

    # list modified files in last commit
    dl = "!git ll -1"

    # diff last commit
    dlc = diff --cached HEAD^
    dr  = "!f() { git diff \"$1\"^..\"$1\"; }; f"
    diffr  = "!f() { git diff \"$1\"^..\"$1\"; }; f"

    # reset commands
    r = reset
    r1 = reset HEAD^
    r2 = reset HEAD^^
    rh = reset --hard
    rh1 = reset HEAD^ --hard
    rh2 = reset HEAD^^ --hard

    # Prunes Local Branches that track a remote, where the remote branch has been deleted
    plb = !git remote prune origin && git branch -vv | grep '\\[[^]]* gone]' | awk '{ print $1 }' | xargs git branch -D
    plb2 = !prune-merged-pull-requests
    plb3 = !git remote prune upstream && git branch -vv | grep '\\[[^]]* gone]' | awk '{ print $1 }' | xargs git branch -D

{{- if .isWork }}

# Include additional work-specific git config (encrypted)
[include]
    path = ~/.gitconfig_work
{{- end }}

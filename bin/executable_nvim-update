#!/usr/bin/env bash
# Update neovim, configs, and plugins
set -e

if command -v brew &>/dev/null; then
    echo "Updating neovim via brew..."
    brew upgrade neovim 2>/dev/null || brew install neovim
fi

if [[ -d ~/.config/nvim/.git ]]; then
    echo ""
    echo "Updating AstroNvim template..."
    git -C ~/.config/nvim fetch upstream 2>/dev/null || \
        git -C ~/.config/nvim remote add upstream https://github.com/AstroNvim/template.git
    git -C ~/.config/nvim pull --rebase upstream main
fi

echo ""
echo "Updating AstroNvim plugins..."
nvim --headless "+Lazy! sync" +qa

mkdir -p ~/.local/state
touch ~/.local/state/nvim-updated
echo ""
echo "Done! Next reminder in 90 days."

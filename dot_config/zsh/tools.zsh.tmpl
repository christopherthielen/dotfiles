# Tool integrations managed by chezmoi

# Environment
export EDITOR="nvim"
export NODE_OPTIONS=--max-old-space-size=8192
export GREP_COLOR='1;31'

# fnm (Node version manager)
if (( $+commands[fnm] )); then
    eval "$(fnm env --use-on-cd --shell zsh)"
    eval "$(fnm completions --shell zsh)"
fi

# Starship prompt
if (( $+commands[starship] )); then
    eval "$(starship init zsh)"
else
    echo '[chezmoi] starship not found, please install it from https://starship.rs'
fi

# autojump - check multiple possible locations
{{- if eq .chezmoi.os "darwin" }}
[[ -s /opt/homebrew/etc/profile.d/autojump.sh ]] && source /opt/homebrew/etc/profile.d/autojump.sh
[[ -s /usr/local/etc/profile.d/autojump.sh ]] && source /usr/local/etc/profile.d/autojump.sh
{{- else }}
[[ -s /usr/share/autojump/autojump.sh ]] && source /usr/share/autojump/autojump.sh
[[ -s /home/linuxbrew/.linuxbrew/etc/profile.d/autojump.sh ]] && source /home/linuxbrew/.linuxbrew/etc/profile.d/autojump.sh
{{- end }}

# gh (GitHub CLI) completions
if (( $+commands[gh] )); then
    eval "$(gh completion -s zsh)"
fi

# mcfly (history search)
if (( $+commands[mcfly] )); then
    export MCFLY_FUZZY=3
    eval "$(mcfly init zsh)"
fi

# fx (JSON viewer) completions
if (( $+commands[fx] )); then
    source <(fx --comp zsh)
fi

# tag-ag integration
if (( $+commands[tag] )); then
    export TAG_SEARCH_PROG=ag
    tag() { command tag "$@"; source "${TAG_ALIAS_FILE:-/tmp/tag_aliases}" 2>/dev/null }
    alias ag=tag
fi

# Neovim quarterly update reminder (nvim-update script is in ~/bin)
_nvim_update_check() {
    local marker=~/.local/state/nvim-updated
    local days=90
    if [[ ! -f $marker ]] || [[ -n $(find "$marker" -mtime +$days 2>/dev/null) ]]; then
        echo "[nvim] Time to update (>$days days). Run: nvim-update"
    fi
}
_nvim_update_check
